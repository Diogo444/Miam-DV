# Miam-DV

## üìú Pr√©sentation

**Miam-DV** est une application web de gestion de menus, recettes et messages pour la cantine.
Elle combine un front-end **Angular** et un back-end **Express** avec une base de donn√©es **MySQL**.

* **Front-end** : interface utilisateur Angular
* **Back-end** : serveur Express (`src/server`) avec des API REST s√©curis√©es via JWT
* **Base de donn√©es** : MySQL pour les utilisateurs, menus, recettes, proverbes, etc.

---

## ‚öôÔ∏è Pr√©requis

* **Node.js** `22.12.0`
* **npm** (inclus avec Node.js)
* **MySQL** (local ou distant)
* Optionnel : **Docker** + **Docker Compose**

---

## üöÄ Installation

1. Clone le d√©p√¥t :

   ```bash
   git clone https://github.com/ton-projet/miam-dv.git
   cd miam-dv
   ```

2. Installe les d√©pendances :

   ```bash
   npm install
   ```

3. Cr√©e un fichier `.env` √† la racine :

   ```env
   JWT_SECRET=your_jwt_secret
   DB_HOST=localhost
   DB_USER=miamdv
   DB_PASSWORD=yourpassword
   DB_DATABASE=miam_dv
   ```

---

## ‚ñ∂Ô∏è Lancer en d√©veloppement

* Lancer le front-end Angular :

  ```bash
  ng serve
  ```

* Lancer le back-end Express :

  ```bash
  npm run serve:ssr
  ```

* Ou tout lancer avec Docker :

  ```bash
  docker-compose up --build
  ```

---

## üìÑ Base de donn√©es

1. Assure-toi que MySQL est lanc√©.
2. Importe le fichier SQL :

   ```bash
   mysql -u miamdv -p miam_dv < backup_miam_dv.sql
   ```

---

## üß∞ Tests & Build

* Lancer les tests unitaires :

  ```bash
  ng test
  ```

* Compiler le projet :

  ```bash
  ng build
  ```

---

## üì° Routes API principales

### `/api`

| M√©thode | Route                | Description                     |
| ------: | -------------------- | ------------------------------- |
|     GET | `/menu`              | R√©cup√®re le menu actuel         |
|    POST | `/menuajout`         | Cr√©e ou modifie le menu         |
|  DELETE | `/menufinal`         | Supprime le menu                |
|     GET | `/proverbe`          | R√©cup√®re le proverbe du jour    |
|    POST | `/proverbeajout`     | Ajoute ou modifie un proverbe   |
|     GET | `/allProverbe`       | Liste des proverbes             |
|     GET | `/miammi`            | Liste des messages utilisateurs |
|    POST | `/miammiajout`       | Ajoute un message               |
|  DELETE | `/deletemsg/:id`     | Supprime un message pr√©cis      |
|  DELETE | `/deletemiammi`      | Vide tous les messages          |
|     GET | `/recipes`           | Liste des recettes              |
|     GET | `/recipe/:slug`      | D√©tail d‚Äôune recette            |
|    POST | `/recipeajout`       | Ajoute une recette              |
|     GET | `/allPreferences`    | Liste toutes les pr√©f√©rences    |
|    POST | `/getPreferences`    | R√©cup√®re les pr√©f√©rences        |
|    POST | `/updatePreferences` | Met √† jour les pr√©f√©rences      |
|    POST | `/addDesign`         | Ajoute un th√®me de style        |

### `/auth`

| M√©thode | Route                     | Description                          |
| ------: | ------------------------- | ------------------------------------ |
|    POST | `/register`               | Inscription                          |
|    POST | `/login`                  | Connexion                            |
|    POST | `/change-password`        | Modifier le mot de passe             |
|    POST | `/change-username`        | Modifier le nom d'utilisateur        |
|  DELETE | `/delete-account/:token`  | Supprimer son compte                 |
|     GET | `/check`                  | V√©rifie l‚Äôauthentification           |
|     GET | `/user`                   | Infos utilisateur connect√©           |
|     GET | `/role`                   | R√¥le de l‚Äôutilisateur                |
|    POST | `/logout`                 | D√©connexion                          |
|     GET | `/all-users`              | Liste des utilisateurs (admin)       |
|  DELETE | `/delete-user/:id`        | Supprime un utilisateur (admin)      |
|   PATCH | `/update-user-passwd/:id` | Change mot de passe d‚Äôun utilisateur |
|   PATCH | `/update-user-role/:id`   | Change r√¥le d‚Äôun utilisateur (admin) |

---

## üìÅ Structure du projet

```
miam-dv/
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/            ‚Üí Code Angular
‚îÇ   ‚îî‚îÄ‚îÄ server/         ‚Üí API Express
‚îú‚îÄ‚îÄ docker-compose.yml ‚Üí D√©ploiement simplifi√©
‚îú‚îÄ‚îÄ .env               ‚Üí Variables d'environnement
‚îú‚îÄ‚îÄ backup_miam_dv.sql ‚Üí Dump SQL de la base
‚îî‚îÄ‚îÄ README.md          ‚Üí Ce fichier
```

---

## üìå Infos utiles

* Angular CLI : [angular.dev/tools/cli](https://angular.dev/tools/cli)
* Express.js : [expressjs.com/fr](https://expressjs.com/fr/)
* MySQL : [dev.mysql.com/doc](https://dev.mysql.com/doc)
