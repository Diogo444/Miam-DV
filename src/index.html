<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>MiamDV</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="MiamDV - Votre menu hebdomadaire">
  <meta name="theme-color" content="#4c9a59">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6031484816129735"
     crossorigin="anonymous"></script>
  <style>
    /* Styles critiques pour éviter le FOUC (Flash Of Unstyled Content) */
    :root {
      --color-primary: #4c9a59;
      --color-background-light: #f8fcf9;
      --color-text-main: #0d1b10;
    }
    body {
      margin: 0;
      font-family: 'Be Vietnam Pro', system-ui, sans-serif;
      background-color: var(--color-background-light);
      color: var(--color-text-main);
    }
    /* Écran de chargement initial */
    .app-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      gap: 16px;
    }
    .app-loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--color-primary);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .app-loading-text {
      color: var(--color-primary);
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <app-root>
    <!-- Contenu de chargement initial visible avant Angular -->
    <div class="app-loading" aria-label="Chargement de l'application" role="status" aria-live="polite">
      <div class="app-loading-spinner" aria-hidden="true"></div>
      <p class="app-loading-text">Chargement...</p>
    </div>
  </app-root>
  <script>
    // Nettoyage des anciens Service Workers et caches (migration)
    // Ce script s'exécute de façon non-bloquante
    (function cleanupLegacySW() {
      if (!('serviceWorker' in navigator)) return;
      
      // Nettoyer les SW seulement si nécessaire (marqueur dans localStorage)
      var swCleanupKey = 'miamdv_sw_cleanup_v1';
      if (localStorage.getItem(swCleanupKey)) return;
      
      Promise.all([
        navigator.serviceWorker.getRegistrations().then(function(regs) {
          return Promise.all(regs.map(function(reg) {
            console.log('[SW Cleanup] Unregistering:', reg.scope);
            return reg.unregister();
          }));
        }),
        'caches' in window ? caches.keys().then(function(keys) {
          return Promise.all(keys.map(function(k) {
            console.log('[SW Cleanup] Deleting cache:', k);
            return caches.delete(k);
          }));
        }) : Promise.resolve()
      ]).then(function() {
        localStorage.setItem(swCleanupKey, Date.now().toString());
        console.log('[SW Cleanup] Complete');
      }).catch(function(err) {
        console.warn('[SW Cleanup] Error:', err);
      });
    })();
  </script>
</body>
</html>
