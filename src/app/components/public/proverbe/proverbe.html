<div class="flex-1 flex flex-col gap-8">
  @if (statusMessage()) {
    <div
      class="rounded-lg border px-4 py-3 text-sm"
      [ngClass]="{
        'border-green-200 bg-green-50 text-green-900 dark:border-green-500/40 dark:bg-green-500/10 dark:text-green-100':
          statusMessage()?.type === 'success',
        'border-red-200 bg-red-50 text-red-700 dark:border-red-500/50 dark:bg-red-500/10 dark:text-red-200':
          statusMessage()?.type === 'error'
      }"
      [attr.role]="statusMessage()?.type === 'error' ? 'alert' : 'status'"
      [attr.aria-live]="statusMessage()?.type === 'error' ? 'assertive' : 'polite'"
    >
      {{ statusMessage()?.text }}
    </div>
  }

  @if (blagueDeLaSemaine(); as blague) {
  <div class="p-4">
    <div
      class="flex flex-col items-stretch justify-start rounded-xl shadow-lg bg-background-light dark:bg-background-dark/50 border border-primary-light dark:border-primary/20"
    >
      <div
        class="flex w-full min-w-72 grow flex-col items-stretch justify-center gap-2 p-6"
      >
        <div class="flex items-center gap-3">
          <span class="material-symbols-outlined text-primary text-2xl" aria-hidden="true"
            >sentiment_very_satisfied</span
          >
          <p class="text-xl font-bold leading-tight tracking-[-0.015em]">
            Blague de la semaine
          </p>
        </div>
        <div class="flex items-end gap-3 justify-between">
          <p class="text-primary text-lg font-normal leading-normal">
            {{ blague.content }}
          </p>
        </div>
      </div>
    </div>
  </div>
  }

  @if (autresProverbes().length) {
    @for (item of autresProverbes(); track item.id) {
  <div class="p-4">
    <div
      class="flex flex-col items-stretch justify-start rounded-xl shadow-lg bg-background-light dark:bg-background-dark/50 border border-primary-light dark:border-primary/20"
    >
      <div
        class="flex w-full min-w-72 grow flex-col items-stretch justify-center gap-2 p-6"
      >
        <div class="flex items-center gap-3">
          <span class="material-symbols-outlined text-primary text-2xl" aria-hidden="true"
            >sentiment_very_satisfied</span
          >
          <p class="text-xl font-bold leading-tight tracking-[-0.015em]">
            {{ item.type }} de la semaine
          </p>
        </div>
        <div class="flex items-end gap-3 justify-between">
          <p
            class="text-text-muted dark:text-primary/90 text-lg font-normal leading-normal"
          >
            {{ item.content }}
          </p>
        </div>
      </div>
    </div>
  </div>
  }
  }

  <div class="p-4">
    <div
      class="flex flex-col items-stretch justify-start rounded-xl shadow-lg bg-background-light dark:bg-background-dark/50 border border-primary-light dark:border-primary/20"
    >
      <div class="flex w-full min-w-72 flex-col items-stretch justify-center p-6 gap-4">
        <div class="flex flex-wrap items-start justify-between gap-4">
          <div class="flex flex-col gap-1">
            <p class="text-xl font-bold leading-tight tracking-[-0.015em]">
              Partagez une blague ou un proverbe
            </p>
            <p
              class="text-text-muted dark:text-primary/90 text-base font-normal leading-normal"
            >
              Votre contribution sera partagée avec les autres utilisateurs et pourrait
              être sélectionnée la semaine prochaine.
            </p>
          </div>
          <button
            (click)="toggleOpen()"
            [attr.aria-expanded]="open()"
            class="inline-flex cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-full bg-primary px-4 py-2 text-base font-medium leading-6 text-white shadow-sm transition-all hover:cursor-pointer hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-background-dark"
          >
            <span>{{ open() ? 'Fermer le formulaire' : 'Suggérer' }}</span>
            <span class="material-symbols-outlined" aria-hidden="true"
              >{{ open() ? 'close' : 'add_circle' }}</span
            >
          </button>
        </div>

        @if (open()) {
        <div class="mt-2">
          <form [formGroup]="form" (ngSubmit)="submitSuggestion()" class="flex flex-col gap-4">
            <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
              <div class="flex flex-col gap-2">
                <label
                  class="text-sm font-medium text-text-main dark:text-background-light"
                  for="type"
                  >Type</label
                >
                <select
                  formControlName="type"
                  class="mt-1 block w-full rounded-md border-primary-light bg-primary-light/60 py-2 pl-3 pr-10 text-base focus:border-primary focus:outline-none focus:ring-primary dark:border-primary/20 dark:bg-background-dark dark:text-background-light dark:focus:border-primary dark:focus:ring-primary sm:text-sm"
                  id="type"
                >
                  <option value="Blague">Blague</option>
                  <option value="Proverbe">Proverbe</option>
                </select>
              </div>
              <div class="flex flex-col gap-2 md:col-span-2">
                <label
                  class="text-sm font-medium text-text-main dark:text-background-light"
                  for="submission"
                  >Votre blague ou proverbe</label
                >
                <textarea
                  formControlName="content"
                  class="mt-1 block w-full rounded-xl border-2 border-primary-light/50 bg-background-light/80 p-4 text-base shadow-inner placeholder:text-text-muted/60 transition-all duration-200 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30 dark:border-primary/30 dark:bg-background-dark/80 dark:text-background-light dark:placeholder:text-background-light/50 dark:focus:border-primary dark:focus:ring-primary/40 resize-none"
                  id="submission"
                  aria-required="true"
                  [attr.aria-invalid]="form.controls['content']?.touched && form.controls['content']?.invalid"
                  [attr.aria-describedby]="form.controls['content']?.touched && form.controls['content']?.invalid ? 'content-error' : null"
                  placeholder="Racontez votre blague ou votre proverbe préféré (min. 3 caractères)"
                  rows="4"
                ></textarea>
                @if (form.controls['content']?.touched && form.controls['content']?.invalid) {
                <p id="content-error" class="text-sm text-red-600" role="alert">3 caractères minimum pour envoyer.</p>
                }
              </div>
            </div>
            <div class="flex justify-end gap-3">
              <button
                type="button"
                (click)="toggleOpen()"
                class="inline-flex cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-full border border-primary-light px-4 py-2 text-base font-medium leading-6 text-text-main dark:text-background-light shadow-sm transition-all hover:cursor-pointer hover:bg-primary-light/60 dark:hover:bg-primary/20"
                aria-label="Fermer le formulaire de suggestion"
              >
                <span>Annuler</span>
              </button>
              <button
                class="inline-flex cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-full bg-primary px-4 py-2 text-base font-medium leading-6 text-white shadow-sm transition-all hover:cursor-pointer hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-background-dark disabled:opacity-60 disabled:cursor-not-allowed"
                type="submit"
                [disabled]="form.invalid || submitting()"
                [attr.aria-busy]="submitting()"
              >
                <span>{{ submitting() ? 'Envoi...' : 'Envoyer' }}</span>
                <span class="material-symbols-outlined"
                  >{{ submitting() ? 'hourglass_top' : 'send' }}</span
                >
              </button>
            </div>
          </form>
        </div>
        }
      </div>
    </div>
  </div>
</div>
