<div class="flex flex-1 flex-col w-full">
  <main class="flex-1 p-6">
    <div
      class="flex flex-col items-stretch justify-start rounded-xl border border-primary-light bg-background-light shadow-lg dark:border-primary/20 dark:bg-background-dark/50"
    >
      <div class="flex w-full flex-col items-stretch justify-center p-6">
        <div class="mb-6">
          <h2 class="text-2xl font-bold leading-tight tracking-[-0.015em]">Modifier un menu</h2>
          <p class="mt-1 text-base font-normal leading-normal text-text-muted dark:text-primary/90">
            Sélectionnez un jour et une période pour mettre à jour le menu correspondant.
          </p>
        </div>
        @if (error()) {
        <div
          class="mb-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-500/50 dark:bg-red-500/10 dark:text-red-200"
          role="alert"
          aria-live="assertive"
        >
          {{ error() }}
        </div>
        }
        @if (success()) {
        <div
          class="mb-4 rounded-lg border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-900 dark:border-green-500/40 dark:bg-green-500/10 dark:text-green-100"
          role="status"
          aria-live="polite"
        >
          {{ success() }}
        </div>
        }

        <div
          class="mb-5 flex flex-col gap-3 rounded-lg border border-dashed border-primary/40 bg-primary-light/30 px-4 py-3 text-sm text-text-main shadow-inner dark:border-primary/25 dark:bg-background-dark/60"
        >
          <div class="flex flex-wrap items-center justify-between gap-3">
            <span
              class="text-xs font-semibold uppercase tracking-wide text-text-muted dark:text-primary/70"
            >
              Menu à éditer
            </span>
            <div class="flex items-center gap-2">
              <span
                class="rounded-full bg-white px-3 py-1 text-xs font-semibold text-primary shadow-sm dark:bg-background-dark/80"
              >
                {{ selectedJour() }}
              </span>
              <span
                class="rounded-full bg-white px-3 py-1 text-xs font-semibold text-primary shadow-sm dark:bg-background-dark/80"
              >
                {{ selectedPeriode() }}
              </span>
            </div>
          </div>
          <p class="text-xs text-text-muted dark:text-primary/80">
            Choisissez le service ci-dessus puis mettez à jour les plats du jour.
          </p>
          @if (!selectedMenu() && menus().length) {
          <p class="text-xs font-semibold text-red-600 dark:text-red-400">
            Aucun menu enregistré pour cette combinaison.
          </p>
          }
        </div>

        <form class="grid grid-cols-1 gap-x-6 gap-y-4 md:grid-cols-2" (ngSubmit)="onSubmit()">
          <div>
            <label class="block text-sm font-medium text-text-main dark:text-background-light" for="day">
              Jour
            </label>
            <select
              class="mt-1 block w-full rounded-md border border-primary/30 bg-background-light/70 py-2 pl-3 pr-10 text-base text-text-main shadow-sm transition focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/60 focus:ring-offset-2 focus:ring-offset-background-light dark:border-primary/25 dark:bg-background-dark/60 dark:text-background-light dark:focus:border-primary dark:focus:ring-primary/70 dark:focus:ring-offset-background-dark sm:text-sm"
              id="day"
              name="day"
              [ngModel]="selectedJour()"
              (ngModelChange)="updateJour($event)"
              [disabled]="loading() || !menus().length"
            >
              @for (day of jours; track day) {
                <option [value]="day">{{ day }}</option>
              }
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-text-main dark:text-background-light" for="meal">
              Déjeuner ou Dîner
            </label>
            <select
              class="mt-1 block w-full rounded-md border border-primary/30 bg-background-light/70 py-2 pl-3 pr-10 text-base text-text-main shadow-sm transition focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/60 focus:ring-offset-2 focus:ring-offset-background-light dark:border-primary/25 dark:bg-background-dark/60 dark:text-background-light dark:focus:border-primary dark:focus:ring-primary/70 dark:focus:ring-offset-background-dark sm:text-sm"
              id="meal"
              name="meal"
              [ngModel]="selectedPeriode()"
              (ngModelChange)="updatePeriode($event)"
              [disabled]="loading() || !menus().length"
            >
              @for (period of periodes; track period) {
                @if (selectedJour() !== 'Vendredi' || period !== 'Dîner') {
                  <option [value]="period">{{ period }}</option>
                }
              }
            </select>
          </div>

          <div class="md:col-span-2 grid grid-cols-1 gap-x-6 gap-y-4 md:grid-cols-2">
            <div>
              <label class="block text-sm font-medium text-text-main dark:text-background-light" for="starter">
                Entrée
              </label>
              <input
                class="mt-1 block w-full rounded-md border border-primary/30 bg-background-light/70 px-3 py-2 text-text-main shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/60 focus:ring-offset-2 focus:ring-offset-background-light placeholder:text-text-muted/70 dark:border-primary/25 dark:bg-background-dark/60 dark:text-background-light dark:placeholder:text-background-light/50 dark:focus:border-primary dark:focus:ring-primary/70 dark:focus:ring-offset-background-dark sm:text-sm"
                id="starter"
                name="starter"
                type="text"
                [ngModel]="entree"
                (ngModelChange)="entree = $event"
                [disabled]="!selectedMenu() || loading()"
              />
            </div>
            <div>
              <label
                class="block text-sm font-medium text-text-main dark:text-background-light"
                for="main-course"
              >
                Plat
              </label>
              <input
                class="mt-1 block w-full rounded-md border border-primary/30 bg-background-light/70 px-3 py-2 text-text-main shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/60 focus:ring-offset-2 focus:ring-offset-background-light placeholder:text-text-muted/70 dark:border-primary/25 dark:bg-background-dark/60 dark:text-background-light dark:placeholder:text-background-light/50 dark:focus:border-primary dark:focus:ring-primary/70 dark:focus:ring-offset-background-dark sm:text-sm"
                id="main-course"
                name="main-course"
                type="text"
                [ngModel]="plat"
                (ngModelChange)="plat = $event"
                [disabled]="!selectedMenu() || loading()"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-text-main dark:text-background-light" for="cheese">
                Fromage
              </label>
              <input
                class="mt-1 block w-full rounded-md border border-primary/30 bg-background-light/70 px-3 py-2 text-text-main shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/60 focus:ring-offset-2 focus:ring-offset-background-light placeholder:text-text-muted/70 dark:border-primary/25 dark:bg-background-dark/60 dark:text-background-light dark:placeholder:text-background-light/50 dark:focus:border-primary dark:focus:ring-primary/70 dark:focus:ring-offset-background-dark sm:text-sm"
                id="cheese"
                name="cheese"
                type="text"
                [ngModel]="fromage"
                (ngModelChange)="fromage = $event"
                [disabled]="!selectedMenu() || loading()"
              />
            </div>
            <div>
              <label
                class="block text-sm font-medium text-text-main dark:text-background-light"
                for="dessert"
              >
                Dessert
              </label>
              <input
                class="mt-1 block w-full rounded-md border border-primary/30 bg-background-light/70 px-3 py-2 text-text-main shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/60 focus:ring-offset-2 focus:ring-offset-background-light placeholder:text-text-muted/70 dark:border-primary/25 dark:bg-background-dark/60 dark:text-background-light dark:placeholder:text-background-light/50 dark:focus:border-primary dark:focus:ring-primary/70 dark:focus:ring-offset-background-dark sm:text-sm"
                id="dessert"
                name="dessert"
                type="text"
                [ngModel]="dessert"
                (ngModelChange)="dessert = $event"
                [disabled]="!selectedMenu() || loading()"
              />
            </div>
          </div>

          <div
            class="md:col-span-2 mt-4 flex items-center justify-end gap-4 border-t border-primary-light pt-4 dark:border-primary/20"
          >
            <button
              class="menu-btn menu-btn--ghost inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-full px-4 py-2 text-base font-medium leading-6 text-text-muted shadow-sm transition-all hover:bg-primary-light/80 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 focus:ring-offset-background-light dark:text-primary/90 dark:hover:bg-primary/10 dark:focus:ring-offset-background-dark"
              type="button"
              [disabled]="loading()"
              aria-label="Annuler la modification du menu"
            >
              <span>Annuler</span>
            </button>
            <button
              class="menu-btn menu-btn--primary inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-full bg-primary px-4 py-2 text-base font-medium leading-6 text-white shadow-sm transition-all hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background-light dark:focus:ring-offset-background-dark"
              type="submit"
              [disabled]="!selectedMenu() || loading()"
              [attr.aria-label]="loading() ? 'Modification en cours' : 'Modifier le menu sélectionné'"
            >
              <span>{{ loading() ? 'En cours...' : 'Modifier le menu' }}</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>
</div>
